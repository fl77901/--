# 软件项目安全开发生命周期

标签（空格分隔）： 第一次实验

---

# 缓冲区溢出漏洞原理分析    
## 一、实验目的    
- 认识缓冲区溢出概念、原理；    
- 设计实验验证缓冲区溢出漏洞；
- 思考防止缓冲区溢出漏洞方法。    
## 二、实验环境    
- Microsoft Visual Studio 2017;    
## 三、实验过程    
- 1.前期设置：    
    创建工程，写入代码、启动c++异常去掉、禁用安全检查、所有选项：SDL检查设置为否、命令参数中输入长的字符串，例如999999999999999999；    
```c
#define _CRT_SECURE_NO_WARNINGS //定义宏使strcpy可以运行通过

#include <stdlib.h>
#include <stdio.h>
#include <string.h>

int sub(char* x)
{
	char y[10];
	strcpy(y, x);
	return 0;
}

int main(int argc, char** argv)
{
	if (argc > 1)
		sub(argv[1]);
	printf("exit");
}
```

- 2.调试执行：    
    - 在char y【10】设置断点，开始执行；    
    打开反汇编、内存、寄存器窗口，调出内存窗口输入esp、ebp查看内存中内容；  
![原始esp][1]
![原始ebp][2]

    - 继续执行下一步，发现程序报错，调出内存输入esp、ebp查看内存中内容，结果esp地址下内容变成自己写入的99999999999字符串(出现了用户操控代码的情况)、ebp地址变成了39393939（39是9的ASCII码）： 
    ![后来esp][3]
    ![后来ebp][4]
    
## 四、实验结果分析    
- 1.缓冲区溢出的概念：  
    缓冲区溢出是指当计算机向缓冲区内填充数据位数时超过了缓冲区本身的容量溢出的数据覆盖在合法数据上，理想的情况是程序检查数据长度并不允许输入超过缓冲区长度的字符，但是绝大多数程序都会假设数据长度总是与所分配的储存空间相匹配，这就为缓冲区溢出埋下隐患，操作系统所使用的缓冲区，又被称为"堆栈"。在各个操作进程之间，指令会被临时储存在"堆栈"当中，"堆栈"也会出现缓冲区溢出。    
- 2.缓冲区溢出的原理：    
    程序员通过往程序的缓冲区写超出其长度的内容，造成缓冲区的溢出，从而破坏程序的堆栈，使程序转而执行其它指令，以达到攻击的目的。
    本实验中代码上面的strcpy()将直接把x中的内容copy到y中。这样只要x的长度大于10，就会造成y的溢出，这会导致程序在为其分配的缓冲区之外写入数据，这样，就可能会覆盖程序用来保存数据的某些内存空间，从而使数据不可用，并最终导致程序崩溃。    
![部分代码图片][5]

- 3.防止缓冲区溢出漏洞的方法：   
目前有四种基本的方法保护缓冲区免受缓冲区溢出的攻击和影响：
    - 1）强制写正确的代码的方法
      编写正确的代码是一件非常有意义但耗时的工作，特别像编写C语言那种具有容易出错倾向的程序（如：字符串的零结尾），这种风格是由于追求性能而忽视正确性的传统引起的。尽管花了很长的时间使得人们知道了如何编写安全的程序，具有安全漏洞的程序依旧出现。因此人们开发了一些工具和技术来帮助经验不足的程序员编写安全正确的程序。虽然这些工具帮助程序员开发更安全的程序，但是由于C语言的特点，这些工具不可能找出所有的缓冲区溢出漏洞。所以，侦错技术只能用来减少缓冲区溢出的可能，并不能完全地消除它的存在。除非程序员能保证他的程序万无一失，否则还是要用到以下部分的内容来保证程序的可靠性能。
    - 2）通过操作系统使得缓冲区不可执行，从而阻止攻击者殖入攻击代码
      这种方法有效地阻止了很多缓冲区溢出的攻击，但是攻击者并不一定要殖入攻击代码来实现缓冲区溢出的攻击，所以这种方法还是存在很多弱点的。
    - 3）利用编译器的边界检查来实现缓冲区的保护
     这个方法使得缓冲区溢出不可能出现，从而完全消除了缓冲区溢出的威胁，但是相对而言代价比较大。
    - 4）在程序指针失效前进行完整性检查
      这样虽然这种方法不能使得所有的缓冲区溢出失效，但它的确确阻止了绝大多数的缓冲区溢出攻击，而能够逃脱这种方法保护的缓冲区溢出也很难实现。    
## 五、实验参考文献    
- https://www.cnblogs.com/-qing-/p/10841625.html    
- https://xz.aliyun.com/t/3784


  [1]: https://s2.ax1x.com/2019/10/16/KifhjS.md.jpg
  [2]: https://s2.ax1x.com/2019/10/16/Kiffc8.md.jpg
  [3]: https://s2.ax1x.com/2019/10/16/KifIBQ.md.jpg
  [4]: https://s2.ax1x.com/2019/10/16/Kif5ng.md.jpg
  [5]: https://s2.ax1x.com/2019/10/16/KifW1f.jpg